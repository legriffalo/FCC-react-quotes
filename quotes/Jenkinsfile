pipeline {
    agent any
    environment {
        VERCEL_TOKEN = credentials('vercel-token') // Store your Vercel token as a Jenkins credential
    }
    stages {
        stage('Build') {
            steps {
                bat 'echo "Installing dependencies..."'
                bat 'npm install'
                bat 'echo "Building the React application..."'
                bat 'npm run build'
            }
        }
        stage('Deploy to Vercel') {
            steps {
                script {
                    def vercelProjectDir = './quotes' // Adjust this if your Vercel project isn't at the root
                    try {
                        bat "npm install -g vercel" // Install Vercel CLI globally (if not already present on agent)
                        bat "vercel pull --yes --token=${env.VERCEL_TOKEN}" // Link local directory to your Vercel project
                        bat "vercel deploy --prebuilt --prod --token=${env.VERCEL_TOKEN} --cwd ${vercelProjectDir}/dist" // Deploy the 'build' folder
                        echo "Successfully deployed to Vercel!"
                    } catch (Exception e) {
                        error "Vercel deployment failed: ${e.getMessage()}"
                    }
                }
            }
        }
    }
}